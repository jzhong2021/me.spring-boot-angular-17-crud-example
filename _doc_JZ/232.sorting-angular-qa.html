<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Q&amp;A - Table Sorting, JavaScript &amp; Angular</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
      margin: 0;
      padding: 2rem;
      background: #f6f7f9;
      color: #111;
      line-height: 1.6;
    }
    h1 {
      margin-top: 0;
    }
    .qa-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,.06);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .question {
      font-weight: 600;
      color: #1a237e;
      margin-bottom: .5rem;
    }
    .answer {
      margin-left: .25rem;
    }
    code, pre {
      font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: .9rem;
    }
    pre {
      background: #f0f2f5;
      padding: .75rem 1rem;
      border-radius: 8px;
      overflow-x: auto;
    }
    ul {
      margin-top: .25rem;
    }
  </style>
</head>
<body>
  <h1>Q&amp;A - Table Sorting, JavaScript &amp; Angular</h1>

  <!-- Q1 -->
  <div class="qa-card">
    <div class="question">
      Q1: 我不太熟悉 JavaScript，帮我解释一下 HTML 示例里 <code>th.addEventListener('click', ...)</code> 在做什么？
    </div>
    <div class="answer">
      <p>
        在 <code>HTML table.Export.save as.html</code> 里，代码对每一个表头单元格
        <code>&lt;th&gt;</code> 调用 <code>addEventListener('click', ...)</code>，表示：
        “当用户点击这个表头时，执行括号里的函数”，从而实现点击表头进行排序。
      </p>
      <p>核心流程概括：</p>
      <ul>
        <li>使用 <code>table.querySelectorAll('th')</code> 拿到所有表头；</li>
        <li>对每个 <code>th</code> 调用 <code>th.addEventListener('click', () =&gt; { ... })</code> 绑定点击事件；</li>
        <li>点击某个表头时：
          <ul>
            <li>确定当前是第几列（<code>index</code>）；</li>
            <li>把 <code>&lt;tbody&gt;</code> 中所有行取出来组成数组；</li>
            <li>按这个列的单元格内容比较（可以根据 <code>data-type</code> 选择按数字或日期比较）；</li>
            <li>排序后再把行按新顺序插回 <code>&lt;tbody&gt;</code>，表格显示顺序就改变了。</li>
          </ul>
        </li>
      </ul>
    </div>
  </div>

  <!-- Q2 -->
  <div class="qa-card">
    <div class="question">
      Q2: 能给一个更简单的例子帮助理解 <code>th.addEventListener('click')</code> 吗？
    </div>
    <div class="answer">
      <p>下面是一个极简版：点击表头按文本排序（不区分数字/日期）。</p>
      <pre><code>&lt;table id="myTable" border="1"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;姓名&lt;/th&gt;
      &lt;th&gt;城市&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;Alice&lt;/td&gt;&lt;td&gt;Berlin&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;Charlie&lt;/td&gt;&lt;td&gt;Tokyo&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;Bob&lt;/td&gt;&lt;td&gt;Paris&lt;/td&gt;&lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;script&gt;
  const table = document.getElementById('myTable');
  const headers = table.querySelectorAll('th');
  const sortDirection = {};

  headers.forEach((th, index) =&gt; {
    th.addEventListener('click', () =&gt; {
      const dir = sortDirection[index] === 'asc' ? 'desc' : 'asc';
      sortDirection[index] = dir;

      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.rows);

      rows.sort((a, b) =&gt; {
        const valA = a.cells[index].textContent.trim();
        const valB = b.cells[index].textContent.trim();
        if (valA &lt; valB) return dir === 'asc' ? -1 : 1;
        if (valA &gt; valB) return dir === 'asc' ? 1 : -1;
        return 0;
      });

      rows.forEach(row =&gt; tbody.appendChild(row));
    });
  });
&lt;/script&gt;</code></pre>
      <p>这样可以直观看到：点击某一列表头时，对该列内容进行排序，表格行顺序随之变化。</p>
    </div>
  </div>

  <!-- Q3 -->
  <div class="qa-card">
    <div class="question">
      Q3: 在 <code>export.component.ts</code> 中的 <code>sortByTitle()</code> 看起来更简单，和 HTML 版排序代码相比有什么不同？
    </div>
    <div class="answer">
      <p>
        你的观察是对的：Angular 里的 <code>sortByTitle()</code> 更简单，主要因为它只对
        <code>this.tutorials</code> 数组排序，而不直接操作 DOM 行（<code>tr</code>）。
      </p>
      <ul>
        <li>Angular 版本：仅修改组件中的数据数组 <code>tutorials</code>，模板用 <code>*ngFor="let t of tutorials"</code> 自动根据数组渲染表格行。</li>
        <li>HTML 版本：需要手工拿 <code>tbody.rows</code> 出来、排序这些 DOM 节点，然后再用 <code>appendChild</code> 重新插回去。</li>
        <li>另外，HTML 那段是通用“任意列排序”，需要处理列索引、类型（数字/日期），逻辑比专门按 <code>title</code> 排要复杂。</li>
      </ul>
    </div>
  </div>

  <!-- Q4 -->
  <div class="qa-card">
    <div class="question">
      Q4: 能否用 <code>sortByTitle()</code> 来实现所有列都可排序？
    </div>
    <div class="answer">
      <p>
        可以，但需要把它改造成“通用排序函数”，例如 <code>sortBy(column, type)</code>，根据传入的列名和类型来排序，
        而不是写死只用 <code>title</code> 字段。
      </p>
      <p>改造思路：</p>
      <ul>
        <li>增加字段：当前排序列 <code>sortColumn</code>，排序方向 <code>sortDirection</code>；</li>
        <li>把 <code>sortByTitle()</code> 改成 <code>sortBy(column, type)</code>；</li>
        <li>在比较函数中，通过 <code>(a as any)[column]</code> 取得对应字段，根据类型转为字符串/数字/日期再比较；</li>
        <li>在 HTML 表头中，使用 <code>(click)="sortBy('id', 'number')"</code> 这类写法为各列绑定排序。</li>
      </ul>
    </div>
  </div>

  <!-- Q5 -->
  <div class="qa-card">
    <div class="question">
      Q5: 已经修改为所有列都可排序，这个通用 <code>sortBy()</code> 和模板是怎么配合的？
    </div>
    <div class="answer">
      <p>在 <code>ExportComponent</code> 中，我们增加了：</p>
      <pre><code>sortDirection: 'asc' | 'desc' = 'asc';
sortColumn: 'id' | 'title' | 'description' | 'published' | null = null;

sortBy(
  column: 'id' | 'title' | 'description' | 'published',
  type: 'string' | 'number' | 'date' = 'string'
): void {
  if (this.sortColumn === column) {
    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
  } else {
    this.sortColumn = column;
    this.sortDirection = 'asc';
  }

  this.tutorials = [...this.tutorials].sort((a, b) =&gt; {
    let valA: any = (a as any)[column];
    let valB: any = (b as any)[column];
    // 归一化并按 type 转换后比较
  });
}</code></pre>
      <p>对应的 HTML 表头大致如下：</p>
      <pre><code>&lt;th scope="col" (click)="sortBy('id', 'number')" style="cursor: pointer"&gt;
  ID
  &lt;span *ngIf="sortColumn === 'id' &amp;&amp; sortDirection === 'asc'"&gt;▲&lt;/span&gt;
  &lt;span *ngIf="sortColumn === 'id' &amp;&amp; sortDirection === 'desc'"&gt;▼&lt;/span&gt;
&lt;/th&gt;
&lt;th scope="col" (click)="sortBy('description', 'string')" style="cursor: pointer"&gt;
  Description
  &lt;span *ngIf="sortColumn === 'description' &amp;&amp; sortDirection === 'asc'"&gt;▲&lt;/span&gt;
  &lt;span *ngIf="sortColumn === 'description' &amp;&amp; sortDirection === 'desc'"&gt;▼&lt;/span&gt;
&lt;/th&gt;
&lt;th scope="col" (click)="sortBy('published', 'string')" style="cursor: pointer"&gt;
  Published
  &lt;span *ngIf="sortColumn === 'published' &amp;&amp; sortDirection === 'asc'"&gt;▲&lt;/span&gt;
  &lt;span *ngIf="sortColumn === 'published' &amp;&amp; sortDirection === 'desc'"&gt;▼&lt;/span&gt;
&lt;/th&gt;
&lt;th scope="col" (click)="sortBy('title', 'string')" style="cursor: pointer"&gt;
  Title
  &lt;span *ngIf="sortColumn === 'title' &amp;&amp; sortDirection === 'asc'"&gt;▲&lt;/span&gt;
  &lt;span *ngIf="sortColumn === 'title' &amp;&amp; sortDirection === 'desc'"&gt;▼&lt;/span&gt;
&lt;/th&gt;</code></pre>
      <p>这样每列都可以点击排序，并且当前排序列会显示对应的方向箭头。</p>
    </div>
  </div>

  <!-- Q6 -->
  <div class="qa-card">
    <div class="question">
      Q6: <code>this.sortColumn</code> 是如何被赋值的？
    </div>
    <div class="answer">
      <p>
        <code>this.sortColumn</code> 只在 <code>sortBy()</code> 方法中被赋值，通过模板里的点击事件间接触发。
      </p>
      <pre><code>sortBy(
  column: 'id' | 'title' | 'description' | 'published',
  type: 'string' | 'number' | 'date' = 'string'
): void {
  if (this.sortColumn === column) {
    this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
  } else {
    this.sortColumn = column;  // &lt;-- 在这里给 this.sortColumn 赋值
    this.sortDirection = 'asc';
  }
  // 后续是基于 column 的排序逻辑
}</code></pre>
      <p>而在 HTML 中有这样的绑定：</p>
      <pre><code>&lt;th (click)="sortBy('id', 'number')"&gt;ID&lt;/th&gt;
&lt;th (click)="sortBy('title', 'string')"&gt;Title&lt;/th&gt;</code></pre>
      <p>点击不同的表头，Angular 调用 <code>sortBy(...)</code> 时传入不同的 <code>column</code> 参数，从而为 <code>this.sortColumn</code> 赋上对应列名。</p>
    </div>
  </div>

  <!-- Q7 -->
  <div class="qa-card">
    <div class="question">
      Q7: 为什么 Angular 里的 <code>sortByTitle()</code> 更简单，不需要手动操作 DOM 行（<code>tr</code>）？这是什么技术？
    </div>
    <div class="answer">
      <p>
        这是 Angular 的“数据驱动 / 声明式渲染”技术，主要依靠
        <strong>模板（<code>*ngFor</code> + 插值 <code>{{ }}</code>）+ 数据绑定 (data binding) + 变更检测 (change detection)</strong>。
		<p>Angular’s “data‑driven, declarative rendering” is mainly powered by templates, data binding, and change detection.</p>
      </p>
      <ul>
        <li>
          模板是声明式的：你写
          <code>&lt;tr *ngFor="let t of tutorials"&gt;...&lt;/tr&gt;</code>，
          表示“请 Angular 按数组 <code>tutorials</code> 生成表格行”，而不是自己写
          <code>createElement('tr')</code> 或 <code>appendChild</code>。
        </li>
        <li>
          在 TS 里，<code>sortByTitle()</code> / <code>sortBy()</code> 只修改
          <code>this.tutorials</code> 数组（即组件的状态 / 数据模型），完全不碰 DOM。
        </li>
        <li>
          Angular 的变更检测会发现 <code>tutorials</code> 变化，然后自动重新计算模板中依赖它的部分，
          相应地增删改 DOM 中的 <code>&lt;tr&gt;</code>，让界面跟数据同步。
        </li>
      </ul>
      <p>
        对比纯 JavaScript 直接操作 DOM（命令式编程），Angular 采用的是“我描述数据应该是什么样，
        框架帮我算出 DOM 应该是什么样”的声明式 UI 模式，这就是它看起来更简单的原因。
      </p>
    </div>
  </div>

</body>
</html>


